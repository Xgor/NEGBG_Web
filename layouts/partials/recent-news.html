{{/* 1. Hämta alla nyhetssidor från det *aktuella* språket */}}
{{ $preferredNews := where .Site.RegularPages "Section" "news" }}

{{/* 2. Hämta alla andra språk-sajter (exklusive den aktuella) */}}
{{ $otherSites := complement (slice .Site) site.Sites }}

{{/* 3. Loopa igenom de andra sajterna och "slå ihop" deras nyhetssidor */}}
{{ range $otherSites }}
  {{ $preferredNews = $preferredNews | lang.Merge (where .RegularPages "Section" "news") }}
{{ end }}

{{/*
 * 4. $preferredNews är nu en komplett lista.
 * Om vi är på /en, innehåller den alla engelska inlägg + svenska inlägg som saknar engelsk översättning.
 * Sortera den och ta de 3 senaste.
 */}}
{{ $recent_news := $preferredNews.ByDate.Reverse | first 3 }}

{{/* 5. Rendera sektionen (oförändrad) */}}
{{ if ge (len $recent_news) 1 }}
<section class="recent-news" style="margin-top: 2.5em; margin-bottom: 2.5em;">
  <h2>Recent News</h2>
  
  <ul class="event-card-list">
    {{ range $recent_news }}
      {{ $page := . }}
      <li class="event-card">
        <div class="event-card-info" style="flex-basis: 100%;">
          
          <h3 class="event-card-title">
            <a href="{{ $page.RelPermalink }}">{{ $page.Title }}</a>
          </h3>
          
          <p class="event-card-date" style="font-size: 0.9em; opacity: 0.7; margin: 0 0 0.5em 0;">
            {{ partial "dates.html" $page.Date }}
          </p>

          {{ with $page.Params.cover }}
            <a href="{{ $page.RelPermalink }}">
              <img src="{{ . | absURL }}" alt="{{ $page.Title }}" class="news-card-cover">
            </a>
          {{ end }}
          
          <div class="event-card-content">
            {{ $page.Summary }}
          </div>
        </div>
      </li>
    {{ end }}
  </ul>
</section>
{{ end }}
